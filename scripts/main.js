"use strict";angular.module("pubTran",["ngAnimate","ngTouch","ui.bootstrap","cb.x2js"]),angular.module("pubTran").constant("bartKey","MW9S-E7SL-26DU-VV8V").constant("idbName","pubTran").constant("idbVersion",1),angular.module("pubTran").factory("Idb",["idbName","idbVersion",function(t,e){var r={};return r.openConnection=function(){return navigator.serviceWorker?idb.open(t,e,function(t){t.createObjectStore("stations",{keyPath:"abbr"})}):Promise.resolve()},r}]),angular.module("pubTran").factory("Sw",function(){function t(){return navigator.serviceWorker?navigator.serviceWorker.register("/Sw.js").then(function(t){return console.log("registered worker with scope: ",t.scope),t})["catch"](function(){console.log("failed to register worker")}):void 0}var e={};return e.worker=t(),e}),angular.module("pubTran").factory("Stations",["$http","x2js","bartKey","Idb",function(t,e,r,n){var o={},a=n.openConnection();return o.getAll=function(){return t({method:"GET",url:"http://api.bart.gov/api/stn.aspx?cmd=stns&key="+r}).then(function(t){var r=e.xml_str2json(t.data).root.stations.station;return a.then(function(t){if(t){var e=t.transaction("stations","readwrite"),n=e.objectStore("stations");r.forEach(function(t){n.put(t)})}}),r})},o}]),angular.module("pubTran").factory("Schedule",["$http","x2js","bartKey",function(t,e,r){var n={};return n.getSchedule=function(n,o){var a="http://api.bart.gov/api/sched.aspx?cmd=arrive&orig="+n+"&dest="+o+"&key="+r;return t({method:"GET",url:a}).then(function(t){return e.xml_str2json(t.data)})},n}]),angular.module("pubTran").controller("mainController",["$scope","Stations","Schedule",function(t,e,r){e.getAll().then(function(e){t.stations=e,t.selectedDeparture=t.stations[0],t.selectedArrival=t.stations[0]}),t.getSchedule=function(){r.getSchedule(t.selectedDeparture.abbr,t.selectedArrival.abbr).then(function(e){t.schedules=e.root.schedule.request.trip})}}]);